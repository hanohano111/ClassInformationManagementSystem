<t-navbar title="作业详情" left-arrow />
<view class="page assignment-detail page-with-navbar">
  <view class="assignment-detail__content">
    <!-- 作业标题 -->
    <view class="assignment-detail__header">
      <view class="assignment-title">{{assignment.title}}</view>
      <view class="assignment-meta">
        <text class="meta-item">{{assignment.creatorName}}</text>
        <text class="meta-divider">·</text>
        <text class="meta-item">{{assignment.createdAtText}}</text>
      </view>
      <view class="assignment-deadline" wx:if="{{assignment.deadline}}">
        <text class="deadline-label">截止时间：</text>
        <text class="deadline-text">{{assignment.deadlineText}}</text>
      </view>
    </view>

    <!-- 作业正文 -->
    <view class="assignment-detail__body" wx:if="{{assignment.content}}">
      <view class="assignment-content">{{assignment.content}}</view>
    </view>

    <!-- 附件列表 -->
    <view class="assignment-detail__attachments" wx:if="{{assignment.attachments && assignment.attachments.length > 0}}">
      <view class="attachments-title">附件（{{assignment.attachments.length}}）</view>
      <view class="attachments-list">
        <block wx:for="{{assignment.attachments}}" wx:for-item="item" wx:key="index">
          <view
            class="attachment-item"
            bindtap="previewAttachment"
            data-url="{{item.url || item.fileID || item.fileId || item.tempFileURL}}"
            data-name="{{item.name}}"
            data-fileid="{{item.fileID || item.fileId}}"
          >
            <t-icon name="attach" size="32rpx" color="#0052d9" />
            <view class="attachment-info">
              <view class="attachment-name">{{item.name}}</view>
              <view class="attachment-size" wx:if="{{item.size}}">{{item.sizeText}}</view>
            </view>
            <t-icon name="chevron-right" size="24rpx" color="#999" />
          </view>
        </block>
      </view>
    </view>

    <!-- 提交作业按钮（允许过期后提交，计为迟交） -->
    <view class="assignment-detail__actions" wx:if="{{!assignment.hasSubmitted}}">
      <t-button theme="primary" block bindtap="goToSubmitAssignment">
        提交作业
      </t-button>
    </view>

    <!-- 成员提交情况（仅管理员可见） -->
    <view class="assignment-detail__members" wx:if="{{assignment.isAdmin && assignment.memberSubmissionList && assignment.memberSubmissionList.length > 0}}">
      <view class="members-title">成员提交情况</view>
      <view class="members-list">
        <block wx:for="{{assignment.memberSubmissionList}}" wx:for-item="member" wx:for-index="idx" wx:key="userId">
          <view class="member-item" bindtap="onMemberTap" data-index="{{idx}}">
            <view class="member-info">
              <text class="member-name">{{member.name}}</text>
      </view>
            <view class="member-status">
              <text class="status-chip status-submitted" wx:if="{{member.submitStatusText === '已提交'}}">已提交</text>
              <text class="status-chip status-overdue" wx:if="{{member.submitStatusText === '迟交'}}">迟交</text>
              <text class="status-chip status-unsubmitted" wx:if="{{member.submitStatusText === '未提交'}}">未提交</text>
              <view class="member-submit-time" wx:if="{{member.hasSubmitted && member.submittedAtText}}">
                <text class="time-text">{{member.submittedAtText}}</text>
      </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>
</view>
