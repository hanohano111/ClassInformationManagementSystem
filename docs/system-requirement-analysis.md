# 系统需求与分析（论文式）

## 摘要
面向教学场景的班级信息化小程序，覆盖建班、成员管理、通知公告、作业布置与批改、考勤签到、请假审批、消息提醒与个人信息管理。系统采用微信小程序 + 云开发架构，前端敏感字段透明 AES 加密，后端统一解密校验与密文存储，满足中小规模课堂教学管理与安全合规需求。

## 1. 引言
- **目的**：明确系统范围、目标、角色、功能与非功能需求，为设计与实现提供依据。
- **读者**：产品/需求、研发、测试、运维、安全合规相关人员。
- **参考文档**：`docs/database-design.md`、`docs/api-design.md`、`docs/implementation-guide.md`、`README-ENCRYPTION.md`。

## 2. 项目概述与目标
- 提供教师与学生的统一教学支撑工具：建班、通知、作业、签到、请假、消息提醒。
- 通过配置驱动的前后端加密策略，保障学号、工号、手机号、作业内容、审批意见等敏感数据安全。
- 提升课堂协同效率，减少线下沟通成本，支撑移动端实时触达。

## 3. 名词与缩写
- **用户/成员**：注册并绑定身份的微信用户。
- **教师/班级管理员**：具备创建班级、布置作业、审批与管理权限的角色。
- **学生**：加入班级后完成作业、签到、请假等操作的角色。
- **云函数**：部署在微信云开发的业务逻辑单元。
- **加密字段**：在传输与存储阶段必须进行 AES 加密的字段。

## 4. 角色与权限
- **访客**：未绑定身份；仅可登录/绑定。
- **学生**：加入班级、查看/提交作业、签到、请假申请、查看通知与消息。
- **教师**：创建/管理班级，发布通知，布置与批改作业，创建签到任务，审批请假。
- **班级管理员（可选）**：辅助教师进行成员管理与审批。
- **系统/后端服务**：密钥管理、数据校验、日志审计、更新发布。

## 5. 业务流程（概要）
1. 登录/绑定：微信登录 → 绑定学号/工号与手机号（前端加密） → 分配角色。
2. 班级加入：学生输入班级码 → 校验 → 建立成员关系 → 通知教师/管理员。
3. 通知发布与阅读：教师创建通知 → 成员拉取 → 阅读状态上报 → 未读数更新。
4. 作业闭环：教师布置 → 学生提交（内容/附件可加密） → 教师批改评分 → 学生查看成绩。
5. 签到：教师创建签到任务（验证码/定位） → 学生签到 → 记录查询与异常处理。
6. 请假审批：学生提交申请（原因加密） → 教师/管理员审批（意见加密） → 状态回执与消息通知。

## 6. 功能需求
### 6.1 账号与身份
- 微信登录获取 token/openid/角色态。
- 身份绑定（学生/教师）：学号/工号、手机号前端加密提交。
- 个人信息查询/更新：敏感字段解密后返回、更新时加密传输。

### 6.2 班级管理
- 创建班级（名称、学期）并生成班级码。
- 加入班级（班级码）；拒绝重复加入与过期班级。
- 成员列表、成员移除、设置/撤销班级管理员。
- 班级详情：名称、学期、人数、管理员。

### 6.3 通知公告
- 创建/编辑/删除通知，支持正文与附件（附件元数据可加密）。
- 通知列表与详情；已读/未读状态、阅读回执统计。

### 6.4 作业管理
- 创建/更新/删除作业（标题、要求、截止时间、附件）。
- 学生提交与更新作业（文本/附件加密）；重复提交需幂等/版本化策略。
- 批改与评分：分数、评语加密；学生端查看成绩。

### 6.5 考勤签到
- 创建签到任务：验证码/定位模式、有效期。
- 获取签到码/任务详情，防止过期与重复使用。
- 学生签到与状态更新；教师查看签到记录与异常标记。

### 6.6 请假审批
- 学生提交请假申请（类型、时间段、原因加密）。
- 审批操作（同意/拒绝、批注加密），记录审批历史。
- 请假列表/详情查询，状态通知。

### 6.7 消息与提醒
- 消息中心：系统与业务消息；未读数通过全局 `eventBus` 推送（参见 `App.setUnreadNum`）。
- 可选模板/订阅消息触达配置。

### 6.8 个人中心与设置
- 个人资料查看/编辑；安全与隐私说明。
- 版本更新提示（`wx.getUpdateManager`）。

### 6.9 系统与运维
- 密钥管理接口：前端获取临时密钥，后端持久保管。
- 文件上传：获取临时 URL；敏感元数据加密。
- 审计与日志：关键操作记录、错误码分级。

## 7. 数据需求
- 数据模型详见 `docs/database-design.md`：用户、班级、成员、通知、作业、提交、批改、请假、审批、签到任务、签到记录等表；包含索引与加密字段标注。
- 加密字段示例：学号、工号、手机号、作业内容、成绩与评语、请假原因与审批意见、附件元数据等。

## 8. 接口需求
- 详细规范见 `docs/api-design.md`，涵盖用户与身份、班级、通知、作业、请假、签到、系统级接口。
- 当前项目以云函数调用为主，敏感字段加密由前端 `utils/crypto.js` 与云函数侧 `common/aes.js` 协同完成。

## 9. 非功能需求
- **性能**：常用列表首屏 ≤1.5s（WiFi），分页/懒加载；云函数超时与重试策略。
- **可靠性**：关键操作幂等/防重复；失败重试与明确错误提示。
- **安全**：全链路 AES-256-CBC；token 鉴权；角色与权限校验；输入校验与防重放；日志脱敏。
- **可用性**：TDesign 小程序组件，基础无障碍支持；错误提示友好。
- **兼容性**：微信基础库 ≥2.6.5；云开发默认环境。
- **可维护性**：配置驱动加密策略，云函数模块化，文档完备。
- **监控与审计**：接口错误码分级、关键操作审计、云函数日志。

## 10. 约束与假设
- 运行环境限定微信小程序与云开发能力（数据库、云存储、云函数）。
- 密钥仅存后端，前端持临时密钥；默认 AES-256-CBC。
- 班级规模中小型（单班 <200 人），面向教学常见场景。
- 文件存储需鉴权访问（临时 URL 或授权访问）。

## 11. 风险与对策（概要）
- **密钥泄露风险**：后端集中管理，临时密钥、最小权限、密钥轮换。
- **网络不稳定**：请求重试、断点续传/二次提交检测、离线提示。
- **权限越权**：接口侧角色鉴权、资源归属校验、操作审计。
- **数据一致性**：幂等令牌/去重键，关键写操作单点事务处理。

## 12. 验收与测试要求
- 单元/集成/安全测试覆盖登录、绑定、加密字段、作业提交/批改、签到、请假审批等关键路径。
- 性能基准：核心接口 P95 ≤1.5s；高频操作无明显卡顿。
- 安全检查：敏感字段全链路加密验证、接口鉴权、输入校验、日志脱敏验证。

## 13. 结论
本系统以微信小程序 + 云开发为基础，通过角色化的教学管理功能与配置驱动的加密策略，满足教学场景的效率与安全需求。上述需求为设计与开发提供约束与验收基准，可结合 `docs/` 现有设计与实现指南快速推进落地。
